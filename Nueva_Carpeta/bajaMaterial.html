<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <title>Gestión de Materiales</title>
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/responsive.css">
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <style>
         html, body {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
         }
         .main-layout {
            flex: 1;
            display: flex;
            flex-direction: column;
         }
         .banner_main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
         }
         .table-container {
            width: 100%;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: #fff;
            border-radius: 10px;
         }
         table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
         }
         table th, table td {
            padding: 10px;
            border: 1px solid #ddd;
         }
         table th {
            background: #007bff;
            color: white;
            font-weight: bold;
         }
         table tr:nth-child(even) {
            background: #f9f9f9;
         }
         button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
         }
         button:hover {
            background-color: #c82333;
         }
      </style>
   </head>
   <body class="main-layout" onload="fetchMaterialData()">
      <section class="banner_main">
         <div class="table-container">
            <h2 style="text-align: center;">Selecciona un Material</h2>
            <select id="materialDropdown" onchange="showSelectedMaterial()">
               <option value="">Selecciona un material...</option>
               <!-- Opciones dinámicas -->
            </select>
         </div>
         <div class="table-container" id="selectedMaterialContainer" style="display: none;">
            <h2 style="text-align: center;">Detalles del Material Seleccionado</h2>
            <table id="materialTable">
               <thead>
                  <tr>
                     <th>ID o Código Único</th>
                     <th>Nombre</th>
                     <th>Cantidad Disponible</th>
                     <th>Uso</th>
                     <th>Fecha de Adquisición</th>
                  </tr>
               </thead>
               <tbody>
                  <!-- Aquí se llenarán los datos dinámicamente -->
               </tbody>
            </table>
            <button onclick="confirmDeleteMaterial()">Borrar Material</button>
         </div>
      </section>
      <script>
         let materials = [];
   
         // Función para obtener los datos de los materiales desde la base de datos
         async function fetchMaterialData() {
            try {
               const response = await fetch('get_materials.php');
               const data = await response.json();
               materials = data;
               const dropdown = document.getElementById("materialDropdown");
               materials.forEach(material => {
                  const option = document.createElement("option");
                  option.value = material.id;
                  option.textContent = `${material.name} (${material.id})`;
                  dropdown.appendChild(option);
               });
            } catch (error) {
               console.error("Error al obtener los datos:", error);
            }
         }
   
         // Mostrar los detalles del material seleccionado
         function showSelectedMaterial() {
            const selectedId = document.getElementById("materialDropdown").value;
            const selectedMaterial = materials.find(material => material.id === selectedId);
            const tableBody = document.querySelector("#materialTable tbody");
            tableBody.innerHTML = "";
            if (selectedMaterial) {
               const row = document.createElement("tr");
               row.innerHTML = `
                  <td>${selectedMaterial.id}</td>
                  <td>${selectedMaterial.name}</td>
                  <td>${selectedMaterial.quantity}</td>
                  <td>${selectedMaterial.usage}</td>
                  <td>${selectedMaterial.date}</td>
               `;
               tableBody.appendChild(row);
               document.getElementById("selectedMaterialContainer").style.display = "block";
            } else {
               document.getElementById("selectedMaterialContainer").style.display = "none";
            }
         }
   
         // Función para confirmar la eliminación del material
         function confirmDeleteMaterial() {
            const selectedId = document.getElementById("materialDropdown").value;
            if (!selectedId) {
               alert("Por favor, selecciona un material.");
               return;
            }
            const confirmDelete = confirm("¿Estás seguro de que deseas borrar este material?");
            if (confirmDelete) {
               deleteMaterial(selectedId);
            }
         }
   
         // Función para borrar el material de la base de datos
         // Función para borrar el material de la base de datos
async function deleteMaterial(materialId) {
    try {
        const response = await fetch(`delete_material.php?id=${materialId}`, { method: "POST" });
        const result = await response.json();
        if (result.success) {
            alert("Material borrado exitosamente.");
            fetchMaterialData(); // Recargar la lista de materiales
            document.getElementById("selectedMaterialContainer").style.display = "none"; // Ocultar tabla

            // Volver a establecer el mensaje "Selecciona un material..." en el dropdown
            const dropdown = document.getElementById("materialDropdown");
            dropdown.innerHTML = '<option value="">Selecciona un material...</option>'; // Limpiar las opciones
            fetchMaterialData(); // Recargar las opciones del dropdown

        } else {
            alert("Error al borrar el material: " + result.message);
        }
    } catch (error) {
        console.error("Error al intentar borrar el material:", error);
        alert("Ocurrió un error al intentar borrar el material.");
    }
}

      </script>
   </body>
</html>
