<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <title>Gestión de Usuarios</title>
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/responsive.css">
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <style>
         html, body {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
         }
         .main-layout {
            flex: 1;
            display: flex;
            flex-direction: column;
         }
         .banner_main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
         }
         .table-container {
            width: 100%;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: #fff;
            border-radius: 10px;
         }
         table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
         }
         table th, table td {
            padding: 10px;
            border: 1px solid #ddd;
         }
         table th {
            background: #007bff;
            color: white;
            font-weight: bold;
         }
         table tr:nth-child(even) {
            background: #f9f9f9;
         }
         button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
         }
         button:hover {
            background-color: #c82333;
         }
      </style>
   </head>
   <body class="main-layout" onload="fetchUsers()">
      <section class="banner_main">
         <div class="table-container">
            <h2 style="text-align: center;">Selecciona un Usuario</h2>
            <select id="userDropdown" onchange="fetchUserDetails()">
               <option value="">Selecciona un usuario...</option>
            </select>
         </div>
         <div class="table-container" id="selectedUserContainer" style="display: none;">
            <h2 style="text-align: center;">Detalles del Usuario Seleccionado</h2>
            <table id="userTable">
               <thead>
                  <tr>
                     <th>ID</th>
                     <th>Nombre</th>
                     <th>Fecha de Nacimiento</th>
                     <th>Correo</th>
                     <th>Teléfono</th>
                     <th>Usuario</th>
                  </tr>
               </thead>
               <tbody>
                  <!-- Aquí se llenarán los datos dinámicamente -->
               </tbody>
               <button onclick="confirmDeleteUser()">Borrar Usuario</button>
            </table>
         </div>
      </section>
      <script>
         async function fetchUsers() {
   try {
      resetDropdown(); // Restablece el menú antes de cargar los datos
      const response = await fetch('get_users.php');
      const users = await response.json();
      const dropdown = document.getElementById("userDropdown");
      users.forEach(user => {
         const option = document.createElement("option");
         option.value = user.id;
         option.textContent = `${user.nombre} (${user.id})`;
         dropdown.appendChild(option);
      });
   } catch (error) {
      console.error("Error al obtener los usuarios:", error);
   }
}


         async function fetchUserDetails() {
            const userId = document.getElementById("userDropdown").value;
            if (!userId) {
               document.getElementById("selectedUserContainer").style.display = "none";
               return;
            }
            try {
               const response = await fetch(`get_user_details.php?id=${userId}`);
               const user = await response.json();
               const tableBody = document.querySelector("#userTable tbody");
               tableBody.innerHTML = `
                  <tr>
                     <td>${user.id}</td>
                     <td>${user.nombre}</td>
                     <td>${user.fecha_nacimiento}</td>
                     <td>${user.correo}</td>
                     <td>${user.telefono}</td>
                     <td>${user.usuario}</td>
                  </tr>
               `;
               document.getElementById("selectedUserContainer").style.display = "block";
            } catch (error) {
               console.error("Error al obtener los detalles del usuario:", error);
            }
         }
      </script>
      <script>
         async function confirmDeleteUser() {
   const userId = document.getElementById("userDropdown").value;
   if (!userId) {
      alert("Por favor, selecciona un usuario.");
      return;
   }
   const confirmDelete = confirm("¿Estás seguro de que deseas borrar este usuario?");
   if (confirmDelete) {
      try {
         const response = await fetch(`delete_user.php?id=${userId}`, { method: "POST" });
         const result = await response.json();
         if (result.success) {
            alert("Usuario borrado exitosamente.");
            fetchUsers(); // Recargar el menú desplegable
            resetDropdown(); // Reiniciar el menú desplegable
            document.getElementById("selectedUserContainer").style.display = "none"; // Ocultar tabla
         } else {
            alert("Error al borrar el usuario: " + result.message);
         }
      } catch (error) {
         console.error("Error al intentar borrar el usuario:", error);
         alert("Ocurrió un error al intentar borrar el usuario.");
      }
   }
}

function resetDropdown() {
   const dropdown = document.getElementById("userDropdown");
   dropdown.innerHTML = '<option value="">Selecciona un usuario...</option>';
}

      </script>
   </body>
</html>
